{"level":"error","message":"Failed to start server: connectElasticsearch is not a function","service":"mongodb-elasticsearch-integration","stack":"TypeError: connectElasticsearch is not a function\n    at startServer (E:\\mongodb-elasticsearch-integration\\src\\app.js:66:15)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2025-06-01 05:43:52"}
{"level":"error","message":"Error creating Elasticsearch index: media_type_header_exception\n\tCaused by:\n\t\tstatus_exception: Accept version must be either version 8 or 7, but found 9. Accept=application/vnd.elasticsearch+json; compatible-with=9\n\tRoot causes:\n\t\tmedia_type_header_exception: Invalid media-type value on headers [Accept, Content-Type]","meta":{"body":{"error":{"caused_by":{"reason":"Accept version must be either version 8 or 7, but found 9. Accept=application/vnd.elasticsearch+json; compatible-with=9","type":"status_exception"},"reason":"Invalid media-type value on headers [Accept, Content-Type]","root_cause":[{"reason":"Invalid media-type value on headers [Accept, Content-Type]","type":"media_type_header_exception"}],"type":"media_type_header_exception"},"status":400},"headers":{"content-length":"426","content-type":"application/json","x-elastic-product":"Elasticsearch"},"meta":{"aborted":false,"attempts":0,"connection":{"_openRequests":0,"deadCount":0,"headers":{"authorization":"[redacted]","user-agent":"elasticsearch-js/9.0.2 (win32 10.0.26100-x64; Node.js 22.3.0; Transport 9.0.1)","x-elastic-client-meta":"es=9.0.2,js=22.3.0,t=9.0.1,un=22.3.0"},"id":"http://localhost:9200/","maxEventListeners":100,"pool":{"_events":{},"_eventsCount":2},"resurrectTimeout":0,"timeout":null,"tls":null,"url":"http://localhost:9200/","weight":1000},"context":null,"name":"elasticsearch-js","request":{"id":3,"options":{},"params":{"body":"{\"settings\":{\"analysis\":{\"analyzer\":{\"autocomplete_analyzer\":{\"type\":\"custom\",\"tokenizer\":\"standard\",\"filter\":[\"lowercase\",\"autocomplete_filter\"]}},\"filter\":{\"autocomplete_filter\":{\"type\":\"edge_ngram\",\"min_gram\":1,\"max_gram\":20}}}},\"mappings\":{\"properties\":{\"CLUSTERID\":{\"type\":\"keyword\",\"fields\":{\"autocomplete\":{\"type\":\"text\",\"analyzer\":\"autocomplete_analyzer\"}}},\"CIDR\":{\"type\":\"keyword\"},\"CIDRIPV4\":{\"type\":\"keyword\"},\"IPV4\":{\"type\":\"ip\"},\"IP\":{\"type\":\"ip\"},\"SITE\":{\"type\":\"keyword\",\"fields\":{\"autocomplete\":{\"type\":\"text\",\"analyzer\":\"autocomplete_analyzer\"}}},\"DESCRIPTION\":{\"type\":\"text\",\"fields\":{\"autocomplete\":{\"type\":\"text\",\"analyzer\":\"autocomplete_analyzer\"}}},\"TIMESTAMP\":{\"type\":\"date\"},\"USERNAME\":{\"type\":\"keyword\"},\"suggest\":{\"type\":\"completion\"}}}}","headers":{"accept":"application/vnd.elasticsearch+json; compatible-with=9","authorization":"[redacted]","content-length":"764","content-type":"application/vnd.elasticsearch+json; compatible-with=9","user-agent":"elasticsearch-js/9.0.2 (win32 10.0.26100-x64; Node.js 22.3.0; Transport 9.0.1)","x-elastic-client-meta":"es=9.0.2,js=22.3.0,t=9.0.1,un=22.3.0"},"method":"PUT","path":"/subnet_search","querystring":""}}},"statusCode":400,"warnings":null},"name":"ResponseError","options":{"redaction":{"additionalKeys":[],"type":"replace"}},"service":"mongodb-elasticsearch-integration","stack":"ResponseError: media_type_header_exception\n\tCaused by:\n\t\tstatus_exception: Accept version must be either version 8 or 7, but found 9. Accept=application/vnd.elasticsearch+json; compatible-with=9\n\tRoot causes:\n\t\tmedia_type_header_exception: Invalid media-type value on headers [Accept, Content-Type]\n    at SniffingTransport._request (E:\\mongodb-elasticsearch-integration\\node_modules\\@elastic\\transport\\lib\\Transport.js:533:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async E:\\mongodb-elasticsearch-integration\\node_modules\\@elastic\\transport\\lib\\Transport.js:631:32\n    at async SniffingTransport.request (E:\\mongodb-elasticsearch-integration\\node_modules\\@elastic\\transport\\lib\\Transport.js:627:20)\n    at async Indices.create (E:\\mongodb-elasticsearch-integration\\node_modules\\@elastic\\elasticsearch\\lib\\api\\api\\indices.js:1135:16)\n    at async createIndexIfNotExists (E:\\mongodb-elasticsearch-integration\\src\\services\\elasticsearchService.js:42:13)\n    at async connectElasticsearch (E:\\mongodb-elasticsearch-integration\\src\\services\\elasticsearchService.js:26:9)\n    at async startServer (E:\\mongodb-elasticsearch-integration\\src\\app.js:66:9)","timestamp":"2025-06-01 05:45:37"}
{"level":"error","message":"Failed to start server: setupChangeStreams is not a function","service":"mongodb-elasticsearch-integration","stack":"TypeError: setupChangeStreams is not a function\n    at startServer (E:\\mongodb-elasticsearch-integration\\src\\app.js:69:15)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2025-06-01 05:53:49"}
{"level":"error","message":"Search error: Cannot read properties of undefined (reading 'hits')","service":"mongodb-elasticsearch-integration","stack":"TypeError: Cannot read properties of undefined (reading 'hits')\n    at search (E:\\mongodb-elasticsearch-integration\\src\\controllers\\searchController.js:80:38)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2025-06-01 05:57:43"}
{"level":"error","message":"Search error: Cannot read properties of undefined (reading 'hits')","service":"mongodb-elasticsearch-integration","stack":"TypeError: Cannot read properties of undefined (reading 'hits')\n    at search (E:\\mongodb-elasticsearch-integration\\src\\controllers\\searchController.js:80:38)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2025-06-01 05:58:11"}
{"level":"error","message":"Search error: Cannot read properties of undefined (reading 'hits')","service":"mongodb-elasticsearch-integration","stack":"TypeError: Cannot read properties of undefined (reading 'hits')\n    at search (E:\\mongodb-elasticsearch-integration\\src\\controllers\\searchController.js:80:38)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2025-06-01 06:02:38"}
{"0":{"index":{"_id":"6837825524dcf9cd2217bb23","_index":"subnet_search","error":{"caused_by":{"reason":"[1:8] Field [_id] is a metadata field and cannot be added inside a document. Use the index API request parameters.","type":"document_parsing_exception"},"reason":"[1:8] failed to parse field [_id] of type [_id] in document with id '6837825524dcf9cd2217bb23'. Preview of field's value: '6837825524dcf9cd2217bb23'","type":"document_parsing_exception"},"status":400}},"1":{"index":{"_id":"6837825524dcf9cd2217bb24","_index":"subnet_search","error":{"caused_by":{"reason":"[1:8] Field [_id] is a metadata field and cannot be added inside a document. Use the index API request parameters.","type":"document_parsing_exception"},"reason":"[1:8] failed to parse field [_id] of type [_id] in document with id '6837825524dcf9cd2217bb24'. Preview of field's value: '6837825524dcf9cd2217bb24'","type":"document_parsing_exception"},"status":400}},"2":{"index":{"_id":"6837825524dcf9cd2217bb25","_index":"subnet_search","error":{"caused_by":{"reason":"[1:8] Field [_id] is a metadata field and cannot be added inside a document. Use the index API request parameters.","type":"document_parsing_exception"},"reason":"[1:8] failed to parse field [_id] of type [_id] in document with id '6837825524dcf9cd2217bb25'. Preview of field's value: '6837825524dcf9cd2217bb25'","type":"document_parsing_exception"},"status":400}},"3":{"index":{"_id":"6837825524dcf9cd2217bb26","_index":"subnet_search","error":{"caused_by":{"reason":"[1:8] Field [_id] is a metadata field and cannot be added inside a document. Use the index API request parameters.","type":"document_parsing_exception"},"reason":"[1:8] failed to parse field [_id] of type [_id] in document with id '6837825524dcf9cd2217bb26'. Preview of field's value: '6837825524dcf9cd2217bb26'","type":"document_parsing_exception"},"status":400}},"4":{"index":{"_id":"6837825524dcf9cd2217bb27","_index":"subnet_search","error":{"caused_by":{"reason":"[1:8] Field [_id] is a metadata field and cannot be added inside a document. Use the index API request parameters.","type":"document_parsing_exception"},"reason":"[1:8] failed to parse field [_id] of type [_id] in document with id '6837825524dcf9cd2217bb27'. Preview of field's value: '6837825524dcf9cd2217bb27'","type":"document_parsing_exception"},"status":400}},"5":{"index":{"_id":"6837825524dcf9cd2217bb28","_index":"subnet_search","error":{"caused_by":{"reason":"[1:8] Field [_id] is a metadata field and cannot be added inside a document. Use the index API request parameters.","type":"document_parsing_exception"},"reason":"[1:8] failed to parse field [_id] of type [_id] in document with id '6837825524dcf9cd2217bb28'. Preview of field's value: '6837825524dcf9cd2217bb28'","type":"document_parsing_exception"},"status":400}},"6":{"index":{"_id":"6837825524dcf9cd2217bb29","_index":"subnet_search","error":{"caused_by":{"reason":"[1:8] Field [_id] is a metadata field and cannot be added inside a document. Use the index API request parameters.","type":"document_parsing_exception"},"reason":"[1:8] failed to parse field [_id] of type [_id] in document with id '6837825524dcf9cd2217bb29'. Preview of field's value: '6837825524dcf9cd2217bb29'","type":"document_parsing_exception"},"status":400}},"7":{"index":{"_id":"6837825524dcf9cd2217bb2a","_index":"subnet_search","error":{"caused_by":{"reason":"[1:8] Field [_id] is a metadata field and cannot be added inside a document. Use the index API request parameters.","type":"document_parsing_exception"},"reason":"[1:8] failed to parse field [_id] of type [_id] in document with id '6837825524dcf9cd2217bb2a'. Preview of field's value: '6837825524dcf9cd2217bb2a'","type":"document_parsing_exception"},"status":400}},"8":{"index":{"_id":"6837825524dcf9cd2217bb2b","_index":"subnet_search","error":{"caused_by":{"reason":"[1:8] Field [_id] is a metadata field and cannot be added inside a document. Use the index API request parameters.","type":"document_parsing_exception"},"reason":"[1:8] failed to parse field [_id] of type [_id] in document with id '6837825524dcf9cd2217bb2b'. Preview of field's value: '6837825524dcf9cd2217bb2b'","type":"document_parsing_exception"},"status":400}},"9":{"index":{"_id":"6837825524dcf9cd2217bb2c","_index":"subnet_search","error":{"caused_by":{"reason":"[1:8] Field [_id] is a metadata field and cannot be added inside a document. Use the index API request parameters.","type":"document_parsing_exception"},"reason":"[1:8] failed to parse field [_id] of type [_id] in document with id '6837825524dcf9cd2217bb2c'. Preview of field's value: '6837825524dcf9cd2217bb2c'","type":"document_parsing_exception"},"status":400}},"level":"error","message":"Bulk sync had errors:","service":"mongodb-elasticsearch-integration","timestamp":"2025-06-01 06:13:51"}
{"cause":{"beforeHandshake":false,"errorLabelSet":{}},"errorLabelSet":{},"level":"error","message":"MongoDB connection error: connect ECONNREFUSED ::1:27017, connect ECONNREFUSED 127.0.0.1:27017","reason":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{"localhost:27017":{"$clusterTime":null,"address":"localhost:27017","arbiters":[],"electionId":null,"error":{"beforeHandshake":false,"errorLabelSet":{}},"hosts":[],"iscryptd":false,"lastUpdateTime":138906977,"lastWriteDate":0,"logicalSessionTimeoutMinutes":null,"maxBsonObjectSize":null,"maxMessageSizeBytes":null,"maxWireVersion":0,"maxWriteBatchSize":null,"me":null,"minRoundTripTime":0,"minWireVersion":0,"passives":[],"primary":null,"roundTripTime":-1,"setName":null,"setVersion":null,"tags":{},"topologyVersion":null,"type":"Unknown"}},"setName":null,"stale":false,"type":"Unknown"},"service":"mongodb-elasticsearch-integration","stack":"MongoServerSelectionError: connect ECONNREFUSED ::1:27017, connect ECONNREFUSED 127.0.0.1:27017\n    at Topology.selectServer (E:\\mongodb-elasticsearch-integration\\node_modules\\mongodb\\lib\\sdam\\topology.js:321:38)\n    at async Topology._connect (E:\\mongodb-elasticsearch-integration\\node_modules\\mongodb\\lib\\sdam\\topology.js:200:28)\n    at async Topology.connect (E:\\mongodb-elasticsearch-integration\\node_modules\\mongodb\\lib\\sdam\\topology.js:152:13)\n    at async topologyConnect (E:\\mongodb-elasticsearch-integration\\node_modules\\mongodb\\lib\\mongo_client.js:233:17)\n    at async MongoClient._connect (E:\\mongodb-elasticsearch-integration\\node_modules\\mongodb\\lib\\mongo_client.js:246:13)\n    at async MongoClient.connect (E:\\mongodb-elasticsearch-integration\\node_modules\\mongodb\\lib\\mongo_client.js:171:13)\n    at async connectMongoDB (E:\\mongodb-elasticsearch-integration\\src\\services\\mongoService.js:16:9)\n    at async startServer (E:\\mongodb-elasticsearch-integration\\src\\app.js:63:9)","timestamp":"2025-06-01 06:23:05"}
{"level":"error","message":"Search error: this.buildMultiFieldQuery is not a function","service":"mongodb-elasticsearch-integration","stack":"TypeError: this.buildMultiFieldQuery is not a function\n    at search (E:\\mongodb-elasticsearch-integration\\src\\controllers\\searchController.js:38:36)\n    at Layer.handle [as handle_request] (E:\\mongodb-elasticsearch-integration\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (E:\\mongodb-elasticsearch-integration\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at validateSearch (E:\\mongodb-elasticsearch-integration\\src\\middleware\\validation.js:34:5)\n    at Layer.handle [as handle_request] (E:\\mongodb-elasticsearch-integration\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (E:\\mongodb-elasticsearch-integration\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (E:\\mongodb-elasticsearch-integration\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (E:\\mongodb-elasticsearch-integration\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at E:\\mongodb-elasticsearch-integration\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (E:\\mongodb-elasticsearch-integration\\node_modules\\express\\lib\\router\\index.js:346:12)","timestamp":"2025-06-02 03:10:53"}
